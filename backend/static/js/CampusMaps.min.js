"use strict";function showSidebar(){$("#sidebar").panel("toggle")}function focusToNewLocation(e,t){map.panTo(new google.maps.LatLng(e,t));map.setZoom(15)}function initialize(){var e=53.524799;var t=-113.520055;var n;if(mobile){n={zoom:6,center:new google.maps.LatLng(e,t),mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:false,panControl:false,zoomControl:true,zoomControlOptions:{style:google.maps.ZoomControlStyle.NORMAL,position:google.maps.ControlPosition.RIGHT_BOTTOM},scaleControl:false,streetViewControl:false,styles:style}}else{n={zoom:6,center:new google.maps.LatLng(e,t),mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:true,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.HORIZONTAL_BAR,position:google.maps.ControlPosition.TOP_RIGHT},panControl:true,panControlOptions:{position:google.maps.ControlPosition.TOP_RIGHT},zoomControl:true,zoomControlOptions:{style:google.maps.ZoomControlStyle.NORMAL,position:google.maps.ControlPosition.TOP_RIGHT},scaleControl:true,streetViewControl:true,streetViewControlOptions:{position:google.maps.ControlPosition.TOP_RIGHT},styles:style}}map=new google.maps.Map(canvas,n);google.maps.Map.prototype.clearOverlays=function(){for(var e=0;e<markersArray.length;e++){markersArray[e].setMap(null)}};google.maps.event.addListener(map,"click",function(e){placeMarker(e.latLng,map)});$("#mapCanvas").show();setTimeout(function(){$("#campusPopup").popup("open")},1e3);createAllPathFields()}function createAllPathFields(){var e=$("#reorderWayPointsList");e.append('<li id="waypoint0" data-icon="false"><a id="printWay0">Depart from</a><a id="deleteWay0" onclick="deleteWaypoint(0)" style="display:none;"></a></li><li id="waypoint1" data-icon="false"><a id="printWay1">Destination</a><a id="deleteWay1" onclick="deleteWaypoint(1)" style="display:none;"></a></li>');for(var t=2;t<10;t++){e.append('<li id="waypoint'+t+'" style="display:none;" data-icon="false"><a id="printWay'+t+'"></a><a id="deleteWay'+t+'" onclick="deleteWaypoint('+t+')" style="display:none;"></a></li>')}e.sortable({disabled:true});e.listview("refresh");waypointAddedCount=2;e.bind("sortstop",function(t,n){e.listview("refresh");newSort=e.sortable("toArray");var r=n.item.index();var i=newSort[r];var s=prevSort.indexOf(i);Waypoint.movePoint(s,r);prevSort=newSort})}function gatherRouteInfo(){clearDirections();if(Waypoint.list.length>=2){queryPath(Waypoint.list)}else{$("#progressPopup").text("Please select more waypoints");$("#progressPopup").popup("open");setTimeout(function(){$("#progressPopup").popup("close")},1300)}}function reorderCurrentPath(){var e=Waypoint.list;var t=$(".pathOptions");var n=t.attr("class");var r=$("#reorderWayPointsList");prevSort=r.sortable("toArray");if(e.length>1){r.sortable({disabled:false})}$("#finishedEditing").show();$("#clearCurrentRoute").show();$("#expandPathOptions").hide();$("#expandEditWaypoints").hide();$("#getDirections").hide();enableSplitView("open");if(n!=="pathOptions ui-screen-hidden"){t.attr("class","pathOptions ui-screen-hidden")}}function enableSplitView(e){var t=$("#reorderWayPointsList").sortable("toArray").length;var n=Waypoint.list.length;for(var r=0;r<n;r++){if(e==="open"){$("#deleteWay"+r).show()}else{$("#deleteWay"+r).hide()}}}function finishedEditingWaypoints(){var e=$("#reorderWayPointsList");$("#finishedEditing").hide();$("#clearCurrentRoute").hide();$("#expandPathOptions").show();$("#expandEditWaypoints").show();$("#getDirections").show();e.sortable({disabled:true});enableSplitView("close")}function deleteWaypoint(e){Waypoint.removePoint(e);waypointAddedCount--;$("#reorderWayPointsList").empty();createAllPathFields();fillCurrentWaypoints();for(var t=Waypoint.list.length-1;t>=0;t--){$("#waypoint"+t).show();$("#deleteWay"+t).show()}}function updateCreatePathFieldFrom(e){var t=$("#createPathDropDown");var n=Waypoint.list;var r=n.length;if(r>2){$("#waypoint"+waypointAddedCount).show();++waypointAddedCount;$("#reorderWayPointsList").listview("refresh")}$("#reorderWayPointsList").trigger("expand");fillCurrentWaypoints();location.hash="#reorderWayPointsList"}function fillCurrentWaypoints(){var e=Waypoint.list;var t=e.length;var n=$("#reorderWayPointsList").sortable("toArray");var r=new google.maps.Geocoder;$.each(e,function(e,t){var i=n[e].slice(-1);var s=$("#printWay"+i);if(t.lat&&t.lng){var o=new google.maps.LatLng(t.lat,t.lng);r.geocode({latLng:o},function(n,r){var i="";if(r===google.maps.GeocoderStatus.OK&&n[0]){i=n[0].formatted_address}else{i="lat:"+t.lat+", lng:"+t.lng}$("#printWay"+e).text(i)})}else if(t.Key){s.text(t.name)}else{s.text(t.name+" "+t.parent.Name)}});$("#reorderWayPointsList").listview("refresh")}function showMorePathOptions(){var e=$(".pathOptions");var t=e.attr("class");var n=$("#expandPathOptions .ui-btn-text");if(t==="pathOptions ui-screen-hidden"){e.attr("class","pathOptions");location.hash="";location.hash="poShow";$("#collapsePathOptions").show();$("#expandPathOptions").hide()}else{e.attr("class","pathOptions ui-screen-hidden");$("#collapsePathOptions").hide();$("#expandPathOptions").show()}}function clearCurrentPath(){Waypoint.list.splice(0,Waypoint.list.length);waypointAddedCount=0;$("#reorderWayPointsList").empty();createAllPathFields();fillCurrentWaypoints();for(var e=Waypoint.list.length-1;e>=0;e--){$("#waypoint"+e).show();$("#deleteWay"+e).show()}finishedEditingWaypoints()}function placeMarker(e,t){var n="";var r=new google.maps.LatLng(e.lat(),e.lng());var i=Waypoint.list.length;var s=new google.maps.Geocoder;var o='<div class="bubbleContainer_options_link" > '+'<a href="javascript:void(0)" class="bubbleContainer_options_directions" onclick="UAlberta.Maps.Exterior.Directions.setWaypointDestination('+e.lat()+","+e.lng()+');"><i></i>Add a destination</a> '+"</div> ";s.geocode({latLng:r},function(r,i){var s="";if(i===google.maps.GeocoderStatus.OK){n=r[0].formatted_address}else{n="lat:"+e.lat()+" lng:"+e.lng()}var u=o;t.panTo(e);infowindow.setContent('<div class="bubbleContainer clearfix">'+'<div class="bubbleContainer_header"> '+"<h1>Coordinate</h1><br />"+"<h3>"+n+"</h3>"+'<div class="bubbleContainer_options"> '+u+"</div> "+"</div> "+"</div>");infowindow.setPosition(e);infowindow.open(t)})}function campusSelect(e){$("#buildingSelectCollapse").trigger("collapse");$("#interiorCanvas").hide();$("#interior_controls").hide();$("#floor_selector").hide();$("#floor_selector_mobile").hide();$("#mapCanvas").show();currentCampus=e;var t=locations[e];var n=t[1];var r=t[2];var i=t[3];focusToNewLocation(n,r);if($(window).width()<800){$("#sidebar").panel("close")}data_cache=new Dictionary;getExteriorData(0,i);appendToBuildingsList();$("#campusSelectCollapse").trigger("collapse")}function showBuildingPopOver(e,t){map.panTo(e.latLng);infowindow.setContent(t.Description);infowindow.setPosition(e.latLng);infowindow.open(map)}function ready(){var e=UAlberta.Maps.Interior;mobile=$(window).width()<800;$("#interior_controls_exit").click(function(){$("#interiorCanvas").hide();$("#interior_controls").hide();$("#floor_selector").hide();$("#floor_selector_mobile").hide();e.clearCanvas();map.setZoom(16);$("#mapCanvas").show()});$("#interior_controls_draw").click(function(){var e=window.location.protocol+"//"+window.location.hostname+":"+window.location.port;$.ajax({type:"GET",dataType:"json",contentType:"application/json",timeout:3e4,url:e+"/api/pathfinding/",success:function(e){drawLine(e)},error:function(e,t,n){alert(t)}})});$("#mainPage").on("swiperight",function(e){if(!mobile){$("#sidebar").panel("open")}});$("#mainPage").on("swipeleft",function(e){if(!mobile){$("#sidebar").panel("open")}});$("#mainPage").on("keyup.panel",function(e){if(!mobile&&e.which===27){$("#sidebar").panel("open")}});var t=20;$("#interior_controls_panUp").click(function(){e.camera.panCameraY(t)});$("#interior_controls_panDown").click(function(){e.camera.panCameraY(-t)});$("#interior_controls_panleft").click(function(){e.camera.panCameraX(t)});$("#interior_controls_panRight").click(function(){e.camera.panCameraX(-t)});var n=20*(Math.PI/180);$("#interior_controls_rotateLeft").click(function(){e.camera.rotateCamera(-n)});$("#interior_controls_rotateRight").click(function(){e.camera.rotateCamera(n)});var r=50;$("#interior_controls_ZoomIn").click(function(){e.camera.zoomCamera(-r)});$("#interior_controls_ZoomOut").click(function(){e.camera.zoomCamera(r)});$("#handiCheckBox").click(function(){var e=getHistory();if($(this).is(":checked")){e.accessibility=true}else{e.accessibility=false}updateHistory(e)});$("input[name=routePrefs]").bind("change",function(e,t){var n=getHistory();if($(this).is(":checked")){n.indoors=$(this).val()}updateHistory(n)});var i=getHistory();$("#handiCheckBox").prop("checked",i.accessibility);$("#handiCheckBox").checkboxradio("refresh");$("input[name=routePrefs][value="+i.indoors+"]").attr("checked",true).checkboxradio("refresh")}function phoneGap(){ready();loadSidebar()}function loadSidebar(){$("#sidebar").on("panelbeforeopen",function(e,t){if(mobile){$("#sticky").css("transform","translate3d(17em,0,0)")}else{$("#sticky").css("left","17em")}});$("#sidebar").on("panelbeforeclose",function(e,t){if(mobile){$("#sticky").css("transform","translate3d(0,0,0)")}$("#sticky").css("left","0em")});if(mobile){$(".listheadertext").css("display","none");$("#sidebar").panel("close");$("#logo").attr("src","static/css/img/logo-reverse-small.svg")}else{$(".listheadertext").css("display","block");$("#sidebar").panel("open");$("#logo").attr("src","static/css/img/logo-reverse.svg")}clearDirections()}function resizeInterior(){$("#interior").attr("height",$(window).height()).attr("width",$("#mainContent").width());UAlberta.Maps.Interior.updateInstance();UAlberta.Maps.Interior.render(true)}var map;var canvas=$("#mapCanvas")[0];var infowindow=new InfoBubble({maxWidth:320,borderRadius:10});var mobile;var currentCampus;var waypointAddedCount=0;var markersArray=[];var newSort,prevSort;var locations=[["North Campus",53.523676,-113.522565,1],["South Campus",53.501649,-113.534463,4],["Augustana Campus",53.01179,-112.823203,16],["Campus Saint-Jean",53.521307,-113.469173,64],["Enterprise Square",53.541537,-113.496705,512],["Calgary Center",51.048193,-114.069822,256]];var style=[{featureType:"poi.attraction",stylers:[{visibility:"off"}]},{featureType:"landscape.man_made",stylers:[{visibility:"off"}]},{featureType:"poi.business",stylers:[{visibility:"off"}]},{featureType:"poi.school",elementType:"labels",stylers:[{visibility:"off"}]}];$("#createPathDropDown").on({expand:function(){fillCurrentWaypoints()}});$(document).ready(ready);$("#sidebar").ready(loadSidebar);$(window).resize(function(){if(!mobile&&$(window).width()<800){$("#sidebar").panel("close");if($("#floor_selector").is(":visible")){$("#floor_selector").hide();$("#floor_selector_mobile").show()}setTimeout(resizeInterior,1e3)}if(mobile&&$(window).width()>=800){if($("#floor_selector_mobile").is(":visible")){$("#floor_selector_mobile").hide();$("#floor_selector").show()}$("#sidebar").panel("close");setTimeout(resizeInterior,1e3)}mobile=$(window).width()<800;if(mobile){$(".listheadertext").css("display","none");$("#logo").attr("src","static/css/img/logo-reverse-small.svg")}else{$(".listheadertext").css("display","block");$("#sidebar").panel("open");$("#logo").attr("src","static/css/img/logo-reverse.svg");$("#mapCanvas").css("bottom","0em");$("#interiorCanvas").css("bottom","0em")}resizeInterior()})