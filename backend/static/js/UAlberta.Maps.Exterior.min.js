var UAlberta=UAlberta!=undefined?UAlberta:{};UAlberta.Maps=UAlberta.Maps!=undefined?UAlberta.Maps:{};if(google){google.load("earth","1")}UAlberta.Maps.Exterior=function(e,t){"use strict";function k(){var e=t(window).height()-c,i=t("body").width();if(!r){t("#leftMenu").css("height",e-42);t("#leftMenu_interior").css("height",e-42);p.update();t("#leftNav_directions_panel").css("max-height",e-450)}t("#instantSearchResults").css({"max-height":e});t("#campus_select_dimmer").css({height:e,width:i});t("#map_canvas").css({height:e,width:i});t("#interior_canvas").attr("height",e).attr("width",i);if(a){UAlberta.Maps.Interior.updateInstance();UAlberta.Maps.Interior.render()}n.event.trigger("resize")}function L(){t("#campus_select_dimmer").hide();t("#instantSearchResults").hide();t(".header_quicklinks_popup").hide();if(r){t("#f_campus_select, #f_quickFinds_select, #f_buildings_select, #f_directions, #f_interiorBuildings, #f_legend, #interior_conrtols_floorSelector").hide();t("#footer_exterior").find("a").removeClass("btn_selected");t("#footer_interior").find("a").removeClass("btn_selected")}}function A(e,o,u){h.map_containerId=e;r=o;p.numberOfLayers=u;if(!m.isBrowserSupportedMaps()){H(m.unsupportedMessage)}c=t(".header").height();if(window.orientation!=undefined){t(window).bind("orientationchange",function(e){e.preventDefault();k()})}else{t(window).resize(function(){k()})}k();var f={name:"UAlberta"};var l=new n.StyledMapType(h.map_styleOptions,f);if(r){h.map_options.zoomControlOptions.position=n.ControlPosition.LEFT_TOP;h.map_options.streetViewControl=false;h.map_options.panControl=false;h.label_building_minZoom=17}d=new n.Map(document.getElementById(h.map_containerId),h.map_options);d.mapTypes.set(h.map_mapTypeId,l);d.setMapTypeId(h.map_mapTypeId);if(window.google.earth.isSupported()&&window.google.earth.isInstalled()){v=new GoogleEarth(d)}n.event.addListener(d,"bounds_changed",function(){y.layerUpdate()});n.event.addListener(d,"click",function(){L()});t("#cluster_box").click(function(e){e.stopPropagation()});t("#campus_select").click(function(e){e.stopPropagation()});if(r){t("#footer_campus").click(function(){t("#f_campus_select").slideToggle("fast",function(){if(t("#f_campus_select").is(":visible"))t("#footer_campus").addClass("btn_selected")});t("#f_quickFinds_select, #f_buildings_select, #f_directions").hide();t("#footer_exterior").find("a").removeClass("btn_selected")});t("#footer_quickFinds").click(function(){t("#f_quickFinds_select").slideToggle("fast",function(){if(t("#f_quickFinds_select").is(":visible"))t("#footer_quickFinds").addClass("btn_selected")});t("#f_campus_select, #f_buildings_select, #f_directions").hide();t("#footer_exterior").find("a").removeClass("btn_selected")});t("#footer_buildings").click(function(){t("#f_buildings_select").slideToggle("fast",function(){if(t("#f_buildings_select").is(":visible"))t("#footer_buildings").addClass("btn_selected")});t("#f_campus_select, #f_quickFinds_select, #f_directions").hide();t("#footer_exterior").find("a").removeClass("btn_selected")});t("#footer_directions").click(function(){t("#f_directions").slideToggle("fast",function(){if(t("#f_directions").is(":visible"))t("#footer_directions").addClass("btn_selected")});t("#f_campus_select, #f_quickFinds_select, #f_buildings_select").hide();t("#footer_exterior").find("a").removeClass("btn_selected")});t("#footer_floor").click(function(){t("#interior_conrtols_floorSelector").slideToggle("fast",function(){if(t("#interior_conrtols_floorSelector").is(":visible"))t("#footer_floor").addClass("btn_selected")});t("#f_interiorBuildings, #f_legend").hide();t("#footer_interior").find("a").removeClass("btn_selected")});t("#footer_legend").click(function(){t("#f_legend").slideToggle("fast",function(){if(t("#f_legend").is(":visible"))t("#footer_legend").addClass("btn_selected")});t("#f_interiorBuildings, #interior_conrtols_floorSelector").hide();t("#footer_interior").find("a").removeClass("btn_selected")});t("#footer_interiorBuildings").click(function(){t("#f_interiorBuildings").slideToggle("fast",function(){if(t("#f_interiorBuildings").is(":visible"))t("#footer_interiorBuildings").addClass("btn_selected")});t("#f_legend, #interior_conrtols_floorSelector").hide();t("#footer_interior").find("a").removeClass("btn_selected")});t("#footer_exit").click(function(){S.closeInterior();t("#f_interiorBuildings, #f_legend, #interior_conrtols_floorSelector").hide();t("#footer_interior").find("a").removeClass("btn_selected")});t("#f_campus_select_min").click(function(){t("#f_campus_select").slideToggle("fast");t("#footer_exterior").find("a").removeClass("btn_selected")});t("#f_quickFinds_select_min").click(function(){t("#f_quickFinds_select").slideToggle("fast");t("#footer_exterior").find("a").removeClass("btn_selected")});t("#f_buildings_select_min").click(function(){t("#f_buildings_select").slideToggle("fast");t("#footer_exterior").find("a").removeClass("btn_selected")});t("#f_directions_min").click(function(){t("#f_directions").slideToggle("fast");t("#footer_exterior").find("a").removeClass("btn_selected")});t("#interior_conrtols_floorSelector_min").click(function(){t("#interior_conrtols_floorSelector").slideToggle("fast");t("#footer_interior").find("a").removeClass("btn_selected")});t("#f_legend_min").click(function(){t("#f_legend").slideToggle("fast");t("#footer_interior").find("a").removeClass("btn_selected")});t("#f_interiorBuildings_min").click(function(){t("#f_interiorBuildings").slideToggle("fast");t("#footer_interior").find("a").removeClass("btn_selected")})}else{var E=d.getStreetView();n.event.addListener(E,"visible_changed",function(){if(i&&s){var e=t("#leftMenu_collapse").parent().is(":visible");if(E.getVisible()){if(e){t("#leftMenu, .leftMenu_collapse_wrapper").hide()}else{t(".leftMenu_collapse_wrapper").hide()}}else{if(!e){t("#leftMenu, .leftMenu_collapse_wrapper").show()}else{t(".leftMenu_collapse_wrapper").show()}}}});t("#leftNav_selectedCampus").click(function(){t("#leftMenu_campusSelect").slideToggle("medium",function(){k()});t("#leftNav_selectedCampus").toggleClass("expanded").toggleClass("collapsed")});t("#leftNav_quickFinds_btn").click(function(){x.hideResults();t("#leftNav_quickFinds").fadeIn("slow");t("#leftNav_buildings,#leftNav_directions").hide();t("#leftMenu .btn-group > a").removeClass("btn_selected");t("#leftNav_quickFinds_btn").addClass("btn_selected")});t("#leftNav_buildings_btn").click(function(){x.hideResults();t("#leftNav_quickFinds,#leftNav_directions").hide();t("#leftNav_buildings").fadeIn("slow");t("#leftMenu .btn-group > a").removeClass("btn_selected");t("#leftNav_buildings_btn").addClass("btn_selected")});t("#leftNav_directions_btn").click(function(){x.hideResults();t("#leftNav_quickFinds,#leftNav_buildings").hide();t("#leftNav_directions").fadeIn("slow");t("#leftMenu .btn-group > a").removeClass("btn_selected");t("#leftNav_directions_btn").addClass("btn_selected")});t("#leftNav_floors_btn_int").click(function(){x.hideResults();t("#interior_conrtols_floorSelector").fadeIn("slow");t("#leftMenu_interior .btn-group > a").removeClass("btn_selected");t("#leftNav_floors_btn_int").addClass("btn_selected")});t("#leftNav_exit_btn").click(function(){S.closeInterior()});t("#leftNav_selectedBuilding").click(function(){t("#leftNav_interiorBuildingList").slideToggle("medium",function(){});t("#leftNav_selectedBuilding").toggleClass("expanded").toggleClass("collapsed")});t("#leftMenu_collapse").click(function(){if(t("#leftMenu").is(":hidden")&&!a){t("#leftMenu").show("slide",{direction:"left"},400);t("#leftMenu_collapse").parent().animate({left:"+=301"},400);t("#legended").animate({left:"+=301"},400)}else if(t("#leftMenu_interior").is(":hidden")&&a){t("#leftMenu_interior").show("slide",{direction:"left"},400);t("#leftMenu_collapse").parent().animate({left:"+=301"},400);t("#legended").animate({left:"+=301"},400)}else{if(!a)t("#leftMenu").hide("slide",{direction:"left"},400);else t("#leftMenu_interior").hide("slide",{direction:"left"},400);t("#leftMenu_collapse").parent().animate({left:"-=301"},400);t("#legended").animate({left:"-=301"},400)}t("#leftMenu_collapse").parent().toggleClass("leftMenu_collapse").toggleClass("leftMenu_expand")});t("#search_clear, #search_clear_int").click(function(){x.clearResults(true)});p.initialize()}t("#campus_select_close").click(function(){t("#campus_select_dimmer").hide()});t("#cluster_box_close").click(b.removeDimLayer);t("#interior_conrtols_exit > a").click(S.closeInterior);g.initialize();_campuses.initialize();w.initialize();if(m.isBrowserSupportedInterior()){UAlberta.Maps.Interior.initialise("interior_canvas",{isMobile:o,defaultCameraRotation:120,defaultCameraPitch:35,defaultCameraRoll:0,maxFPS:30})}x.initialize();t(document).keypress(O);i=true}function O(e){var e=e?e:event?event:null;if(e.keyCode==13){e.preventDefault();return false}if(e.keyCode==27){e.preventDefault();L();return false}return true}function M(e,t){d.setCenter(e);d.setZoom(t);if(v!=null&&d.getMapTypeId()=="GoogleEarthAPI"){v.refreshEarth(e.lat(),e.lng(),t)}}function _(e,i){var s=y.getLayer("building_outlines"),o="no_campus";if(s){for(var u=s.polyList.length-1;u>=0;u--){var a=s.polyList[u];if(a.buildingKey==e){o=a.Campus;var f=new n.LatLng(a.PolyCenter.lat,a.PolyCenter.lng);d.setCenter(f);d.setZoom(17);n.event.trigger(a,"click",{latLng:f});if(v!=null&&d.getMapTypeId()=="GoogleEarthAPI"){v.refreshEarth(f.lat(),f.lng(),18)}break}}if(r){t("#f_buildings_select").hide();t("#footer_exterior").find("a").removeClass("btn_selected")}if(!i){C.itemClick(o+"_buildings",e)}}}function D(e){var t=h.host_url;if(!e){var n=d.getCenter();var r=n.lat()+","+n.lng();var i=d.getZoom();var s="";for(var o=y.layerList.length-1;o>=0;o--){if(y.layerList[o].display&&y.layerList[o].key.indexOf("building")==-1&&y.layerList[o].key!="campus_outlines"){if(s!=""){s+=","}s+=y.layerList[o].key}}t+="?l="+r+"&z="+i+"&c="+s+"&campus="+u}else{var a=y.buildingLinks.lookup(e);if(a){t+="?b="+a.buildingKey}}return t}function P(){t("#generalLinkBox").show().css({width:"0",height:"0"});t("#generalLinkBox").animate({width:"220px",height:"50px"},400);t("#generalLinkBox > input").val(D(false))}function H(e){if(t("#message_popup_wrapper").length>0){return}t("<div id='message_popup_wrapper'><div id='message_popup'><a href='javascript:void(0)' id='message_popup_close'></a>"+e+"</div></div>").hide().appendTo("body > form").fadeIn("fast");t("#message_popup_close").click(function(){t("#message_popup").fadeOut("fast",function(){t("#message_popup_wrapper").remove()})})}var n=window.google.maps,r=false,i=false,s=false,o=15,u="",a=false,f="",l=0,c=0,h={host_url:window.location.protocol+"//"+window.location.hostname+"/",image_path:"~/media/uofa2/Maps/Images/",pdf_path:"~/media/uofa2/Maps/pdf/",map_containerId:"",map_campusDescriptionContainerId:"",map_styleOptions:[{featureType:"administrative.locality",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"administrative.neighborhood",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"administrative.land_parcel",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"landscape.man_made",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"poi",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"poi.park",elementType:"all",stylers:[{visibility:"on"}]},{featureType:"water",elementType:"all",stylers:[{visibility:"simplified"}]},{featureType:"road.highway",elementType:"all",stylers:[{saturation:-45}]},{featureType:"road.arterial",elementType:"all",stylers:[{saturation:-45}]}],map_options:{zoom:6,center:new n.LatLng(52.597528,-115.136719),mapTypeControlOptions:{style:n.MapTypeControlStyle.DROPDOWN_MENU,mapTypeIds:["uab",n.MapTypeId.SATELLITE]},zoomControlOptions:{style:n.ZoomControlStyle.SMALL,position:n.ControlPosition.RIGHT_TOP},panControlOptions:{position:n.ControlPosition.RIGHT_TOP},streetViewControlOptions:{position:n.ControlPosition.RIGHT_TOP}},map_mapTypeId:"uab",clusterDistance:50,earthOffset:268435456,earthRadius:268435456/Math.PI,label_textSize:20,label_textColor:"#75A57A",label_textStrokeColor:"#005108",label_minZoom:7,label_maxZoom:14,label_building_textSize:10,label_building_textColor:"#000000",label_building_textStrokeColor:"#FFFFFF",label_building_minZoom:16,label_building_maxZoom:25,markers_minZoom:0,markers_maxZoom:21,showCampusLabels:true,showBuildingLabels:true},p={iconHeight:43,maxIcons:10,minPixelsRequired:350,iconsToShow:10,currentOffset:0,maxOffset:0,numberOfLayers:0,initialize:function(){p.update();p.maxOffset=p.iconHeight*p.numberOfLayers;t("#leftNav_quickFinds_viewPort_next").click(function(){p.scroll(1)});t("#leftNav_quickFinds_viewPort_prev").click(function(){p.scroll(-1)})},update:function(){if(r){return}var e=t(window).height()-p.minPixelsRequired;if(t("#leftMenu_campusSelect").is(":visible")){e-=t("#leftMenu_campusSelect").height()}if(e<=p.iconHeight){p.iconsToShow=1}else{p.iconsToShow=Math.floor(e/p.iconHeight);if(p.iconsToShow>p.maxIcons){p.iconsToShow=p.maxIcons}}t(".leftNav_quickFinds_viewPort").css("height",p.iconsToShow*p.iconHeight+"px");var n=e-138;t("#leftNav_buildings").find("div.leftMenu_list_container > ul").each(function(){if(this.scrollHeight>e){t(this).css("height",n+"px")}});if(t("#leftNav_searchResults > div")[0].scrollHeight>e){t("#leftNav_searchResults > div").css("height",e)}},scroll:function(e){if(e>0){p.currentOffset=p.currentOffset-p.iconsToShow*p.iconHeight}else if(e<0){p.currentOffset=p.currentOffset+p.iconsToShow*p.iconHeight}if(p.currentOffset<=p.maxOffset*-1){p.currentOffset=0}if(p.currentOffset>p.iconHeight){var n=p.numberOfLayers%p.iconsToShow;if(n==0){n=p.iconsToShow}p.currentOffset=(p.maxOffset-n*p.iconHeight)*-1}t(".leftNav_quickFinds_icons").children().animate({top:p.currentOffset},400)}},d=null,v=null,m={minIE:7,minFireFox:3,minSafari:4,minChrome:0,unsupportedMessage:"Hold on. It looks like you might have an older version of your web browser. Be sure to use the latest version to enjoy all the features on the UAlberta map.",isBrowserSupportedMaps:function(){return!(t.browser.msie&&t.browser.version<m.minIE||t.browser.mozilla&&t.browser.version<m.minFireFox)},isBrowserSupportedInterior:function(){var e=document.createElement("canvas");return!!(e.getContext&&e.getContext("2d"))}},g={},y={layerList:[],addNewLayer:function(e,n,i){if(r){for(var s=0;s<y.layerList.length;s++){var o=y.layerList[s];if(o.key=="campus_outlines"||o.key=="building_outlines"||o.key=="search_results"||o.key==i.layerKey){continue}y.removeLayer(o.key);t(".quickFinds_icons > li > a").each(function(){t(this).attr("class",t(this).attr("class").replace("_active",""))})}t("#f_quickFinds_select").hide();t("#footer_quickFinds").removeClass("btn_selected")}E.loadJSONObject(e,n,i);C.itemClick("quick_finds",i.layerKey)},createLayer:function(e){var t={};t.key=e.layerKey?e.layerKey:"newLayer_"+(new Date).getTime();t.displayName=e.displayName?e.displayName:"New Layer";t.url="";t.delay=e.delay?e.delay:0;t.display=e.display!=undefined?e.display:true;t.creationDate=Math.round((new Date).getTime()/1e3);t.useCluster=e.useCluster!=undefined?e.useCluster:true;t.titleAsDesc=e.titleAsDesc!=undefined?e.titleAsDesc:false;t.markerScale=e.markerScale?e.markerScale:new n.Size(24,24);t.markers=new Array;t.masterMarkerList=new Array;t.clusteredMarkers=new Array;t.cloneMarkers=function(){var e=this.masterMarkerList.length;var t=new Array;while(e--){var r=this.masterMarkerList[e];var i=new n.Marker({position:r.getPosition(),icon:r.getIcon(),flat:r.getFlat()});i.layerKey=this.key;i.markerKey=r.markerKey;i.display=r.display;i.description=r.description;i.actionId=r.actionId;if(r.infoWindow!=null){i.infoWindow=new InfoBubble({content:r.infoWindow.getContent(),maxWidth:755})}t.push(i)}return t};t.lineList=new Array;t.polyList=new Array;t.overlayList=new Array;t.legend=e.legend?e.legend:[];t.runMarkerUpdate=e.runMarkerUpdate!=undefined?e.runMarkerUpdate:true;t.googleKML=null;t.labels=new Array;return t},addLayer:function(e){var t=-1;for(var n=y.layerList.length-1;n>=0;n--){if(y.layerList[n].key==e.key){t=n;break}}if(t==-1)y.layerList.push(e);else y.layerList[t]=e},removeLayer:function(e){var t=y.getLayer(e);if(t){y.hideLayer(t);t.masterMarkerList=[];t.markers=[];t.clusteredMarkers=[];t.lineList=[];t.polyList=[];t.overlayList=[];var n=-1;for(var r=y.layerList.length-1;r>=0;r--){if(y.layerList[r].key==e){n=r;break}}if(n>=0){y.layerList.splice(n,1)}}},getLayer:function(e){for(var t=y.layerList.length-1;t>=0;t--){if(y.layerList[t].key==e){return y.layerList[t]}}return null},toggleLegened:function(e,n){if(n.legend.length==0||e&&t("#"+n.key+"_legend").length>0){return}if(e){var r="<div id='"+n.key+"_legend' class='item_legend'><ul>";for(var i=0;i<n.legend.length;i++){r+="<li><img src='"+h.host_url+n.legend[i].icon+"' height='24px' width='24px' alt='"+n.legend[i].displayName+"' /> "+n.legend[i].displayName+"</li>"}r+="</ul></div>";t("#legended").append(r);if(t("#legended").find("li").length>1){t("#legended").show()}}else{t("#"+n.key+"_legend").remove();if(t("#legended").find("li").length<=1){t("#legended").hide()}}},displayLayer:function(e,t){if(a){return}e.display=true;y.toggleLegened(true,e);if(e.googleKML!=null){e.googleKML.setMap(d)}else{if(!t){b.clusterMarkers(e)}var r=d.getBounds(),i;for(i=e.clusteredMarkers.length-1;i>=0;i--){if(r.contains(e.clusteredMarkers[i].center)&&!e.clusteredMarkers[i].display){e.clusteredMarkers[i].centerMarker.setMap(d);e.clusteredMarkers[i].display=true;n.event.addListener(e.clusteredMarkers[i].centerMarker,"click",function(e){var t=y.getLayer(this.layerKey);var n=b.getClusterItem(t,this.markerKey);if(n!=null){y.hideInfoWindows();b.dimLayer();b.unclusterCluster(n,t,t.displayName,e)}})}}for(i=e.markers.length-1;i>=0;i--){if(r.contains(e.markers[i].getPosition())&&!e.markers[i].display){e.markers[i].setMap(d);e.markers[i].display=true;n.event.addListener(e.markers[i],"click",function(){y.hideInfoWindows();if(this.infoWindow!=null){this.infoWindow.open(d,this)}else if(this.description!=""){this.infoWindow=new InfoBubble({content:this.description,maxWidth:500});this.infoWindow.open(d,this)}})}}for(i=e.lineList.length-1;i>=0;i--){e.lineList[i].setMap(d)}for(i=e.polyList.length-1;i>=0;i--){e.polyList[i].setMap(d);if(e.polyList[i].label){e.polyList[i].label.setMap(d)}}for(i=e.overlayList.length-1;i>=0;i--){e.overlayList[i].setMap(d)}for(i=e.labels.length-1;i>=0;i--){e.labels[i].setMap(d)}}},hideLayer:function(e){e.display=false;y.toggleLegened(false,e);if(e.googleKML!=null){e.googleKML.setMap(null)}var t=d.getMapTypeId(),n;for(n=e.markers.length-1;n>=0;n--){e.markers[n].setMap(null);if(e.markers[n].infoWindow!=null){e.markers[n].infoWindow.close()}}for(n=e.clusteredMarkers.length-1;n>=0;n--){e.clusteredMarkers[n].centerMarker.setMap(null)}for(n=e.lineList.length-1;n>=0;n--){e.lineList[n].setMap(null)}for(n=e.polyList.length-1;n>=0;n--){e.polyList[n].setMap(null);if(e.polyList[n].label){e.polyList[n].label.setMap(null)}}for(n=e.overlayList.length-1;n>=0;n--){e.overlayList[n].setMap(null)}for(n=e.labels.length-1;n>=0;n--){e.labels[n].setMap(null)}if(v!=null&&t=="GoogleEarthAPI"){v.refreshEarth()}},hideInfoWindows:function(){for(var e=y.layerList.length-1;e>=0;e--){var t=0,n=y.layerList[e];for(t=n.markers.length-1;t>=0;t--){if(n.markers[t].infoWindow!=null){n.markers[t].infoWindow.close()}}for(t=n.polyList.length-1;t>=0;t--){if(n.polyList[t].infoWindow){n.polyList[t].infoWindow.close()}}}},toggleLayer:function(e){var n="leftNav_quickLinks_"+e.key;if(e.display){y.hideLayer(e);t("."+n+"_active").attr("class",n)}else{y.displayLayer(e,false);t("."+n).attr("class",n+"_active")}},layerUpdate:function(){var e=false;if(o!=d.getZoom()){e=true;o=d.getZoom()}for(var r=y.layerList.length-1;r>=0;r--){if(!y.layerList[r].runMarkerUpdate){continue}if(y.layerList[r].display){var i=true;if(e){i=false;this.hideLayer(y.layerList[r])}if(o>h.markers_minZoom&&o<h.markers_maxZoom){this.displayLayer(y.layerList[r],i)}}}if(e){_campuses.processLabels();g.render();if(o==20){t.ajax({type:"POST",url:window.location.protocol+"//"+window.location.hostname+"static/css/maps/img/fun.txt",dataType:"json",contentType:"application/json",timeout:E.timeout,success:function(e){E.ajaxSuccess(e,{layerKey:"creators",useCluster:false,markerScale:new n.Size(30,30)})},error:function(){}})}else{y.removeLayer("creators")}}},updateInfoWindow:function(e,n){var r=t(".bubbleContainer_content");if(r.is(":visible")){t(".bubbleContainer_options_info_active").attr("class","bubbleContainer_options_info");r.hide();infowindow.update(t(".bubbleContainer_header").height()+20)}else{t(".bubbleContainer_options_info").attr("class","bubbleContainer_options_info_active");r.show();infowindow.update(r.height()+t(".bubbleContainer_header").height()+20)}}},b={clusterMarkers:function(e){if(e.display==false)return;var t=new Array;var r=new Array;var i=e.cloneMarkers();while(i.length){var s=i.pop();var o=s.getPosition();var u=new Array;var a=i.length;var f=s.getIcon().url;if(e.useCluster){while(a--){var l=i[a].getPosition();var c=b.pixelDistance(o.lat(),o.lng(),l.lat(),l.lng(),d.getZoom());var p=i[a].getIcon().url;if(h.clusterDistance>c&&f==p){u.push(i[a]);i.splice(a,1)}}}if(u.length>0){u.push(s);var v=b.getCenterOfCluster(u);var m=24;var g=u.length;if(g<=5){m=28}else if(g>5&&g<=10){m=32}else if(g>10&&g<=20){m=36}else if(g>20&&g<=50){m=40}else if(g>50&&g<=100){m=44}else if(g>100){m=48}var y=new n.Marker({position:v,icon:{url:f,size:new n.Size(m,m),scaledSize:new n.Size(m,m)},flat:true});y.markerKey=r.length;y.layerKey=e.key;r.push({markers:u,center:v,centerMarker:y,display:false})}else{t.push(s)}}e.markers=t;e.clusteredMarkers=r},pixelDistance:function(e,t,n,r,i){var s=b.lonToX(t);var o=b.latToY(e);var u=b.lonToX(r);var a=b.latToY(n);return Math.sqrt(Math.pow(s-u,2)+Math.pow(o-a,2))>>21-i},lonToX:function(e){return Math.round(h.earthOffset-h.earthRadius*e*Math.PI/180)},latToY:function(e){return Math.round(h.earthOffset-h.earthRadius*Math.log((1+Math.sin(e*Math.PI/180))/(1-Math.sin(e*Math.PI/180)))/2)},getCenterOfCluster:function(e){var t=0;var r=0;for(var i=e.length-1;i>=0;i--){var s=e[i].getPosition();t+=s.lat();r+=s.lng()}t=t/e.length;r=r/e.length;return new n.LatLng(t,r)},getClusterItem:function(e,t){if(e!=null){if(e.clusteredMarkers[t])return e.clusteredMarkers[t]}return null},unclusterCluster:function(e,n,r){var i="";for(var s=e.markers.length-1;s>=0;s--){i+="<div class='ums_cluserData_panel_item'>"+e.markers[s].description+"</div><hr class='ums_cluserData_panel_hr' />"}t("#cluster_box_content").html(i);t("#cluster_box_heading > span").html(r+" ( "+e.markers.length+" )")},dimLayer:function(){t("#campus_select_dimmer").show();t("#campus_select").hide();t("#cluster_box").show()},removeDimLayer:function(){t("#campus_select_dimmer").hide()}},w={directionsDisplay:new n.DirectionsRenderer,directionsService:new n.DirectionsService,travelMode:n.TravelMode.WALKING,initialize:function(){t("input#directionsA").autocomplete({source:w.autoComplete,select:w.autoCompleteClick});t("input#directionsB").autocomplete({source:w.autoComplete,select:w.autoCompleteClick});t("input#directionsA").keyup(function(e){if(e.keyCode==13){e.preventDefault();w.processDirections();return false}t("input#directionsA_position").val("")});t("input#directionsB").keyup(function(e){if(e.keyCode==13){e.preventDefault();w.processDirections();return false}t("input#directionsB_position").val("")});t("#directionsClear").click(function(){w.clearDirections()})},processDirections:function(){var e=t("#directionsA").val();var i=t("#directionsB").val();var s=t("#directionsA_position").val();var o=t("#directionsB_position").val();if(s!=""){e=s}if(o!=""){i=o}if(e!=""&&i!=""){var u={origin:e,destination:i,travelMode:w.travelMode};w.directionsService.route(u,function(e,r){if(r==n.DirectionsStatus.OK){w.directionsDisplay.setMap(d);w.directionsDisplay.setDirections(e);if(w.travelMode==n.TravelMode.DRIVING){w.directionsDisplay.setPanel(t("#leftNav_directions_panel")[0])}}});if(r){t("#footer_directions").click()}C.itemClick("directions",w.travelMode==n.TravelMode.DRIVING?"driving":w.travelMode==n.TravelMode.WALKING?"walking":"biking")}},clearDirections:function(){w.directionsDisplay.setMap(null);w.directionsDisplay.setPanel(null);t("input#directionsA").val("");t("input#directionsB").val("");t("input#directionsA_position").val("");t("input#directionsB_position").val("")},toggleTravelMode:function(e,r){if(e=="car"){w.travelMode=n.TravelMode.DRIVING}else if(e=="walking"){w.travelMode=n.TravelMode.WALKING;w.directionsDisplay.setPanel(null)}else if(e=="bicycling"){w.travelMode=n.TravelMode.BICYCLING;w.directionsDisplay.setPanel(null)}w.processDirections();t(".map_directions_type").each(function(){t(this).removeClass("selected")});t(r).parent().addClass("selected")},setDestination:function(e){var n=data_cache.lookup(e).displayName;var r={Building:{Key:e,name:n}};Waypoint.addPoint(r);t("#progressPopup").text("Added building to the route");t("#progressPopup").popup("open");setTimeout(function(){t("#progressPopup").popup("close")},1300);infowindow.close();updateCreatePathFieldFrom("building")},setWaypointDestination:function(e,n){var r={Coord:{lat:e,lng:n}};Waypoint.addPoint(r);t("#progressPopup").text("Added destination to the route");t("#progressPopup").popup("open");setTimeout(function(){t("#progressPopup").popup("close")},1300);infowindow.close();updateCreatePathFieldFrom("waypoint")},setStartingWaypoint:function(e,n){var r={Coord:{lat:e,lng:n}};Waypoint.destinationFrom(r);t("#progressPopup").text("Added starting waypoint to the route");t("#progressPopup").popup("open");setTimeout(function(){t("#progressPopup").popup("close")},1300);infowindow.close();updateCreatePathFieldFrom("start")},setEndingWaypoint:function(e,n){var r={Coord:{lat:e,lng:n}};Waypoint.destinationTo(r);t("#progressPopup").text("Added ending waypoint to the route");t("#progressPopup").popup("open");setTimeout(function(){t("#progressPopup").popup("close")},1300);infowindow.close();updateCreatePathFieldFrom("end")},setMarkerDestination:function(e,n,r){var i={Coord:{lat:n,lng:r}};Waypoint.addPoint(i);t("#progressPopup").text("Added destination to the route");t("#progressPopup").popup("open");setTimeout(function(){t("#progressPopup").popup("close")},1300);infowindow.close();updateCreatePathFieldFrom("waypoint")},autoComplete:function(e,t){var n=6;var r=new Array;y.buildingLinks.sortKeys();for(var i=0;i<y.buildingLinks.length();i++){var s=y.buildingLinks.lookup(y.buildingLinks.lookupKey(i)),o=s.position.lat+","+s.position.lng;if(e.term.length<2){if(s.displayName.toLowerCase().indexOf(e.term.toLowerCase())==0){r.push({label:s.displayName,value:o})}}else{if(s.displayName.toLowerCase().indexOf(e.term.toLowerCase())!=-1){r.push({label:s.displayName,value:o})}}if(r.length==n){break}}t(r)},autoCompleteClick:function(e,n){var r=t(this).attr("id");t("#"+r).val(n.item.label);t("#"+r+"_position").val(n.item.value);return false},generateLink:function(){var e=D(false);var n=encodeURIComponent(t("#directionsA").val()),r=encodeURIComponent(t("#directionsB").val()),i=encodeURIComponent(t("#directionsA_position").val()),s=encodeURIComponent(t("#directionsB_position").val());e+="&dirA="+n+"&dirB="+r+"&dirAPos="+i+"&dirBPos="+s+"&travel="+w.travelMode;t("#directionsLinkBox").show().css({width:"0",height:"0","margin-left":"10px"});t("#directionsLinkBox").animate({width:"220px",height:"50px"},400);t("#directionsLinkBox > input").val(e)}},E={activeLoadingBars:[],hostUrl:window.location.protocol+"//"+window.location.hostname+"/WebService/Maps/UWSDataService.asmx/GetExteriorData",timeout:3e4,toggleLoadingBar:function(e,n){var r=n.replace(/ /g,"_").replace(/'/g,"").replace("(","").replace(")","")+"_loadingBar";if(e){E.activeLoadingBars.push(n);t("#loading_bar_area").append("<div id='"+r+"' style='display: none;' class='loading_bar'><img src='~/media/uofa2/Maps/Images/arrow-loader.gif' /> Loading the "+n+" Layer.</div>");t("#"+r).fadeIn("slow")}else{t("#"+r).fadeOut("slow",function(){t("#"+r).remove()});E.activeLoadingBars.splice(t.inArray(n,E.activeLoadingBars),1)}},toggleErrorBar:function(){t("#error_bar").fadeIn("medium",function(){setTimeout(function(){t("#error_bar").fadeOut("medium")},5e3)})},loadJSONObject:function(e,n,i){if(i.layerKey!="building_outlines"){var o=y.getLayer(i.layerKey);if(o!=null){y.toggleLayer(o);return}}else{y.removeLayer("building_outlines")}E.toggleLoadingBar(true,i.displayName);t.ajax({type:"POST",url:E.hostUrl,dataType:"json",contentType:"application/json",timeout:E.timeout,data:E.toJSON({category:e,flag:n,interior:a,buildingKey:f,floor:l,isMobile:r}),success:function(e){E.ajaxSuccess(e,i);if(i.layerKey=="building_outlines"){if(s){t("#buildingList_"+u).click()}}},error:function(){E.ajaxError(i.displayName)}})},toJSON:function(e){var n;if(n&&n.stringify){return'{ "parameters":'+n.stringify(e)+"}"}else{return'{ "parameters":'+t.toJSON(e)+"}"}},ajaxSuccess:function(e,i){if(!e&&!e.d){E.toggleLoadingBar(false,i.displayName);E.toggleErrorBar();return}e=e.d;if(!e.__type&&e.__type!="UAlberta.WebService.Maps.Data.InteriorReturn"){E.toggleLoadingBar(false,i.displayName);E.toggleErrorBar();return}var s=y.createLayer(i),o=new Dictionary;var u=0;if(e.Markers){for(u=0;u<e.Markers.length;u++){var a=e.Markers[u],f=h.host_url+a.IconUrl,l=false,c=null;if(a.Description!=""){l=true}var p=new n.Marker({position:new n.LatLng(a.Coords.lat,a.Coords.lng),icon:{url:f,scaledSize:s.markerScale},flat:true,clickable:l});p.layerKey=s.key;p.markerKey=s.masterMarkerList.length;p.display=false;p.description=a.Description;p.infoWindow=c;s.masterMarkerList.push(p)}}if(e.Lines){for(u=0;u<e.Lines.length;u++){var v=e.Lines[u],m=[];m.push(new n.LatLng(v.Start.lat,v.Start.lng));m.push(new n.LatLng(v.End.lat,v.End.lng));var g=v.Transparency/255;s.lineList.push(new n.Polyline({clickable:false,path:m,strokeWeight:v.Width,strokeColor:"#"+v.Color,strokeOpacity:g}))}}if(e.PolyLines){for(u=0;u<e.PolyLines.length;u++){var b=e.PolyLines[u],m=[];for(var w=0;w<b.Path.length;w++){m.push(new n.LatLng(b.Path[w].lat,b.Path[w].lng))}if(m.length>0){var g=b.LineTransparency/255;s.lineList.push(new n.Polyline({clickable:false,path:m,strokeWeight:b.LineWidth,strokeColor:"#"+b.LineColor,strokeOpacity:g}))}}}if(e.Polys){for(u=0;u<e.Polys.length;u++){var S=e.Polys[u],m=[];for(var w=0;w<S.Path.length;w++){m.push(new n.LatLng(S.Path[w].lat,S.Path[w].lng))}if(m.length>0){var x=S.LineTransparency/255,T=S.PolyTransparency/255;var N=new n.Polygon({paths:m,strokeWeight:S.LineWidth,fillColor:"#"+S.PolyColor,fillOpacity:T,strokeColor:"#"+S.LineColor,strokeOpacity:x});N.infoWindow=null;if(S.Description!=""||s.titleAsDesc&&S.Name!=""){N.description=S.Description!=""?S.Description:"<div class='ums_bubble_container clearfix'><div class='description-container'><h1>"+S.Name+"</h1></div></div>";N.layer=s;N.name=S.Name;n.event.addListener(N,"click",function(e){y.hideInfoWindows();var t=null;if(e){t=e.latLng}if(this.infoWindow==null){this.infoWindow=new InfoBubble({content:this.description,shawdowStyle:1});var n=y.buildingLinks.lookup(this.buildingKey);if(n){n.infoWindow=this.infoWindow}}this.infoWindow.setPosition(t);this.infoWindow.open(d)})}if(S.BuildingKey&&S.Campus&&S.PolyCenter){N.buildingKey=S.BuildingKey;N.PolyCenter=S.PolyCenter;N.Campus=S.Campus;if(o.containsKey(S.Campus)){o.lookup(S.Campus).add(S.BuildingKey,{campus:S.Campus,displayName:S.Name,buildingKey:S.BuildingKey,formerName:S.FormerName,infoWindow:N.infoWindow,position:N.PolyCenter,levels:S.levels})}else{var C=new Dictionary;C.add(S.BuildingKey,{campus:S.Campus,buildingKey:S.BuildingKey,displayName:S.Name,formerName:S.FormerName,infoWindow:N.infoWindow,position:N.PolyCenter,levels:S.levels});o.add(S.Campus,C)}}s.polyList.push(N)}}}if(e.Labels){for(u=0;u<e.Labels.length;u++){var k=e.Labels[u];s.labels.push(new MapLabel({text:k.Name,position:new n.LatLng(k.Coords.lat,k.Coords.lng),origin:new n.LatLng(k.Coords.lat,k.Coords.lng),fontSize:h.label_building_textSize,fontColor:h.label_building_textColor,strokeColor:h.label_building_textStrokeColor,minZoom:h.label_building_minZoom,maxZoom:h.label_building_maxZoom,className:"ums_mapBuildingLabel",id:("bl_"+k.Coords.lat+""+k.Coords.lng).replace(/\./g,"").replace(/-/g,""),ismobile:r}))}}y.addLayer(s);if(s.display){y.displayLayer(s,false);t("."+"leftNav_quickLinks_"+s.key).attr("class","leftNav_quickLinks_"+s.key+"_active")}E.addBuildingLinks(o);E.toggleLoadingBar(false,i.displayName)},ajaxError:function(e){E.toggleLoadingBar(false,e);E.toggleErrorBar()},addBuildingLinks:function(e){if(e.length()==0){return}var n=r?"#f_buildings_select":"#leftNav_buildings";for(var i=0;i<e.length();i++){var s=e.lookupKey(i),o=e.lookup(s),u="";if(!r){u="<li><span><a href='javascript:void(0);' class='buildingList collapsed' id='buildingList_"+s.replace(" ","_").replace("-","_").toLowerCase()+"'>"+e.lookupKey(i)+"</a></span><div class='leftMenu_list_container'><ul style='display:none;'>"}for(var a=0;a<o.length();a++){var f=o.lookupKey(a),l=o.lookup(f);u+="<li><a href='javascript:void(0);' onclick='UAlberta.Maps.Exterior.focusBuilding(\""+l.buildingKey+"\");'>"+l.displayName+"</a></li>";y.buildingLinks.add(f,l)}if(!r){u+="</ul></div></li>";t(n+" > ul").append(u)}else{t(n+" > ul").html(u)}}if(!r){t(".buildingList").click(function(){t(n).find(".buildingList").not(this).removeClass("expanded").addClass("collapsed").parent().parent().find("> div > ul").slideUp("fast");t(this).toggleClass("expanded").toggleClass("collapsed").parent().parent().find("> div > ul").slideToggle("fast",function(){var e=t(window).height()-p.minPixelsRequired;var n=e-138;if(this.scrollHeight>e){t(this).css("height",n+"px")}})})}}},S={launchInterior:function(e,n,r,i){if(!n){n=1}getInteriorData(e,n,i);mobile=t(window).width()<800;var s=data_cache.lookup(e);t("[id^=interior_popup]").hide();t("#floor_sel").empty();var o="";t.each(s.levels,function(r,i){if(n==i.FloorNumber){o="ui-btn-active";t("#floor_selector_dropdown h2 span .ui-btn-text").text(i.displayName)}else{o=""}var s="floor-item-"+r;var u="floor-choice-"+r;var a="<li id='"+s+"' data-mini='true' class='"+o+"'' data-corners=\"false\" data-theme='a'><a>"+i.displayName+"</a></li>";t("#floor_sel").append(a);t("#"+s).click(function(){t("[id^=floor-item]").removeClass("ui-btn-active");getInteriorData(e,i.FloorNumber);t("#"+s).addClass("ui-btn-active");t("#floor_selector_dropdown h2 span .ui-btn-text").text(i.displayName);t("#"+u).trigger("click");t.each(t("fieldset#floor_selector_field  input[type='radio']"),function(e,n){if(n.name==u){t("#"+n.name).attr("checked",true)}else{t("#"+n.name).attr("checked",false)}t("#"+n.name).checkboxradio().checkboxradio("refresh")})})});t("#floor_sel").trigger("create");t("#floor_sel").listview("refresh");t("fieldset#floor_selector_field").empty();t.each(s.levels,function(n,r){var i="floor-choice-"+n;var s="floor-item-"+n;t("fieldset#floor_selector_field").append('<input type="radio" name="'+i+'" id="'+i+'" value="'+r.FloorNumber+'" >');t("fieldset#floor_selector_field").append('<label for="'+i+'">'+r.displayName+"</label>");t("#"+i).bind("change",function(n,o){getInteriorData(e,t(this).val());t.each(t("fieldset#floor_selector_field  input[type='radio']"),function(e,n){if(n.name!=i){t("#"+n.name).attr("checked",false);t("#"+n.name).checkboxradio().checkboxradio("refresh")}});t("[id^=floor-item]").removeClass("ui-btn-active");t("#"+s).addClass("ui-btn-active");t("#floor_selector_dropdown h2 span .ui-btn-text").text(r.displayName)});t("#"+i).checkboxradio().checkboxradio("refresh")});t.each(t("fieldset#floor_selector_field  input[type='radio']"),function(e,r){if(r.value==n){t("#"+r.name).attr("checked",true);t("#"+r.name).checkboxradio().checkboxradio("refresh")}});t("#radio-choice-0").attr("checked",true);t("#radio-choice-0").checkboxradio().checkboxradio("refresh");t("#floor_selector").trigger("create")},switchBuilding:function(e){f=e;l=1;var n=y.buildingLinks.lookup(e),i=n?n.displayName:e.toUpperCase();UAlberta.Maps.Interior.clearCanvas();UAlberta.Maps.Interior.updateInstance();UAlberta.Maps.Interior.importBuildingData(e,"1",i,true);S.addLevels(e);t("#interior_conrtols_floorSelector > ul > li > a").removeClass("active");t("#floor_1").addClass("active");if(r){t("#f_interiorBuildings").hide();t("#footer_interior > a").removeClass("btn_selected");t("#interior_selectedBuilding").html(i).parent().show();t("#footer_floor").html("Floor 1")}else{t("#leftNav_selectedBuilding").html(i)}t("#interior_popup_contContain").parent().remove()},addLevels:function(e){t("#interior_conrtols_floorSelector > ul").html("");var n=y.buildingLinks.lookup(e);for(var r=0;r<n.levels.length;r++){t("#interior_conrtols_floorSelector > ul").append("<li><a id='floor_"+n.levels[r].FloorNumber+"' href='javascript:void(0);' onclick='UAlberta.Maps.Exterior.switchLevel( \""+e+'", "'+n.levels[r].FloorNumber+"\");'>"+n.levels[r].displayName+"</a></li>")}},switchLevel:function(e,n){f=e;l=n;var i=y.buildingLinks.lookup(e);UAlberta.Maps.Interior.clearCanvas();UAlberta.Maps.Interior.updateInstance();UAlberta.Maps.Interior.importBuildingData(e,n.toString(),i.displayName,false);t("#interior_conrtols_floorSelector > ul > li > a").removeClass("active");t("#floor_"+n).addClass("active");if(r){t("#interior_conrtols_floorSelector").hide();t("#footer_interior > a").removeClass("btn_selected");t("#footer_floor").html("Floor "+n.toString().replace("-","B"))}t("#interior_popup_contContain").parent().remove();C.itemClick(i.campus+"_"+e+"_switchLevel","floor_"+n)},closeInterior:function(){C.itemClick(f+"_close","close_interior");UAlberta.Maps.Interior.clearCanvas();t("#interior_canvas").hide();t("#map_canvas").show();_(f,true);a=false;f="";l=0;if(r){t("#footer_interior").hide();t("#footer_exterior").show();t("#interior_selectedBuilding").html("").parent().hide();t(".clearSearch").show()}else{t("#leftMenu").show();t("#leftMenu_collapse").parent().css("left",301);t("#leftMenu_collapse").parent().removeClass("leftMenu_expand").addClass("leftMenu_collapse");t("#leftMenu_interior").hide();if(t(".item_legend").length>1){t("#legended").show()}else if(t(".item_legend").length==1){if(t(".item_legend > ul > li").length>1){t("#legended").show()}}}t("#interior_controls").hide();t("#interior_popup_contContain").parent().remove()}},x={hostUrl:window.location.protocol+"//"+window.location.hostname+"/WebService/Maps/UWSDataService.asmx/SearchMap",ajaxRequests:[],minCharacters:3,requestInProgress:false,changeSinceLastRequest:false,displayAfterRequest:false,results:[],initialize:function(){t("#txtSearchTerms").keyup(function(e){e.preventDefault();if(e.keyCode==13){if(x.requestInProgress){for(var n=0;n<x.ajaxRequests.length;n++){x.ajaxRequests[n].abort()}x.ajaxRequests=[]}x.displayAfterRequest=true;x.processSearch(t("#txtSearchTerms").val());return false}else if(e.keyCode>8&&e.keyCode<=45){return false}x.processSearch(t("#txtSearchTerms").val());return false});t("#btnSearch").click(function(e){e.preventDefault();if(x.requestInProgress){for(var n=0;n<x.ajaxRequests.length;n++){x.ajaxRequests[n].abort()}x.ajaxRequests=[]}x.displayAfterRequest=true;x.processSearch(t("#txtSearchTerms").val());return false})},processSearch:function(e){t("#instantSearchResults > ul").html("");if(e.length<x.minCharacters||!s){x.results=[];t("#instantSearchResults").hide();return}var n=[],r=e.split(" ");for(var i=y.buildingLinks.length()-1;i>=0;i--){var o=y.buildingLinks.lookupKey(i),u=y.buildingLinks.lookup(o);for(var a=0;a<r.length;a++){var f=u.formerName.toLowerCase().indexOf(jQuery.trim(r[a].toLowerCase()))!=-1;if(u.displayName.toLowerCase().indexOf(jQuery.trim(r[a].toLowerCase()))!=-1||f){var l=u.displayName;if(f){l+="<span class='buildingFormerName'>Formerly "+u.formerName+"</span>"}n.push({display:l,type:"b",parent:u.buildingKey});break}}}if(n.length>0){n=n.splice(0,10);n.sort(function(e,t){return e.display-t.display});var c="";for(var h=n.length-1;h>=0;h--){c+="<li><a href='javascript:void(0);' onclick='UAlberta.Maps.Exterior.searchResultClick(\""+n[h].type+'","'+n[h].parent+"\")'>"+n[h].display+"</a></li>"}t("#instantSearchResults > ul").append(c)}t("#instantSearchResults > ul").append("<li id='searchLoading'><img src='~/media/uofa2/Maps/Images/search-loader.gif' /></li>");t("#instantSearchResults").show();t("#search_noResults").remove();if(!x.requestInProgress){x.loadSearch(e);x.changeSinceLastRequest=false}else{x.changeSinceLastRequest=true}},loadSearch:function(e){x.requestInProgress=true;x.ajaxRequests.push(t.ajax({type:"POST",url:x.hostUrl,dataType:"json",contentType:"application/json",timeout:E.timeout,data:E.toJSON({term:e,interior:a,buildingKey:f,floor:l}),success:function(e){x.ajaxSuccess(e)},error:function(){},complete:function(){x.requestInProgress=false;if(x.changeSinceLastRequest){x.processSearch(t("#txtSearchTerms").val())}}}))},ajaxSuccess:function(e){if(!e&&!e.d){return}e=e.d;if(!e.__type&&e.__type!="UAlberta.WebService.Maps.Data.SearchReturn"){return}t("#searchLoading").remove();x.results=e.results;var n="";for(var r=0;r<x.results.length;r++){var i=x.results[r].type!="r"?'"'+x.results[r].action+'"':"",s=x.results[r].type!="r"?'"'+x.results[r].action+'"':x.results[r].action;n+="<li class='searchResult_item'><a href='javascript:void(0);' id='"+i+"' onclick='UAlberta.Maps.Exterior.searchResultClick(\""+x.results[r].type+'","'+x.results[r].parent+'",'+s+", true);'>"+x.results[r].display+"</a></li>"}if(x.results.length==0&&t("#instantSearchResults > ul").html()==""){n+="<li id='search_noResults'>No Results Found</li>"}t("#instantSearchResults > ul").append(n);t("#instantSearchResults").show();if(t("#instantSearchResults > ul").height()>t("#instantSearchResults").height()){t("#instantSearchResults").css({"overflow-y":"auto"})}if(x.displayAfterRequest){x.displayResults();x.displayAfterRequest=false}},ajaxError:function(){t("#instantSearchResults").html("").hide();E.toggleErrorBar()},resultClick:function(e,r,i,s){switch(e){case"b":if(a){S.closeInterior()}_(r);break;case"l":if(s){var o=y.getLayer("search_results");if(o!=null){x.clearResults(false)}}for(var u=0;u<x.results.length;u++){var f=x.results[u];if(f.type==e&&f.parent==r&&f.action==i){var l=y.getLayer("search_results");if(l){for(var c=l.markers.length-1;c>=0;c--){var h=l.markers[c];if(h.actionId==i){n.event.trigger(h,"click");break}}}else{x.displayResults(i);l=y.getLayer("search_results");if(l&&l.markers.length>0){n.event.trigger(l.markers[0],"click")}}break}}break;case"r":_(r);UAlberta.Maps.Interior.clearCanvas();S.launchInterior(r,i.floor,i.name);break;default:break}t("#instantSearchResults").hide()},displayResults:function(e){if(x.results.length==0){return}var i=y.getLayer("search_results");if(i!=null){x.clearResults(false)}var s=y.createLayer({layerKey:"search_results",displayName:"Search Results",useCluster:false,display:true});for(var o=0;o<x.results.length;o++){if(x.results[o].type=="l"){if(e!=undefined){if(e!=x.results[o].action){continue}}var u=x.results[o].Marker,a=h.host_url+u.IconUrl,f=false,l=null;if(u.Description!=""){f=true}var c=new n.Marker({position:new n.LatLng(u.Coords.lat,u.Coords.lng),icon:{url:a,scaledSize:s.markerScale},flat:true,clickable:f});c.layerKey=s.key;c.markerKey=s.masterMarkerList.length;c.display=false;c.description=u.Description;c.infoWindow=l;c.actionId=x.results[o].action;s.masterMarkerList.push(c)}}if(s.masterMarkerList.length>0){y.addLayer(s);y.displayLayer(s,false)}if(r){t("<a href='javascript:void(0);'class='clearSearch'><i></i>Clear Results</a>").appendTo("#form1");t(".clearSearch").click(function(){x.clearResults(true)})}else{t("#searchLoading").hide();t("#instantSearchResults, #leftNav_quickFinds, #leftNav_buildings, #leftNav_directions, #interior_conrtols_floorSelector").hide();t("#leftMenu .btn-group > a, #leftMenu_interior .btn-group > a").removeClass("btn_selected");if(e==undefined){t("#leftNav_searchResults > div").html(t("#instantSearchResults").html().replace(/, true\)/g,", false)"))}else{t("#leftNav_searchResults > div").html(t("#"+e).parent().html())}t("#leftNav_interior_searchResults > div").html(t("#leftNav_searchResults > div").html());t("#leftNav_interior_searchResults").show();t("#leftNav_searchResults").show()}},hideResults:function(){t("#leftNav_searchResults > div, #leftNav_interior_searchResults > div").hide();t("#leftNav_searchResults_link, #leftNav_interior_searchResults_link").addClass("collapsed");t("#interior_conrtols_floorSelector,#leftNav_quickFinds").show();t("#leftNav_searchResults_link,#leftNav_interior_searchResults_link").click(function(){t("#instantSearchResults, #leftNav_quickFinds, #leftNav_buildings, #leftNav_directions, #interior_conrtols_floorSelector").hide();t("#leftMenu .btn-group > a, #leftMenu_interior .btn-group > a").removeClass("btn_selected");t("#leftNav_searchResults > div, #leftNav_interior_searchResults > div").show();t("#leftNav_searchResults_link, #leftNav_interior_searchResults_link").removeClass("collapsed")})},clearResults:function(e){if(e){x.results=[]}if(r){t(".clearSearch").remove()}else{t("#leftNav_searchResults > div, #leftNav_interior_searchResults > div").html("");t("#leftNav_searchResults, #leftNav_interior_searchResults").hide();t("#leftNav_buildings, #interior_conrtols_floorSelector").show();t("#leftNav_buildings_btn, #leftNav_floors_btn_int").addClass("btn_selected")}y.removeLayer("search_results");t("#txtSearchTerms").val("")}},T={regesterEvent:function(e,r,i){n.event.addListenerOnce(d,e,r);if(i){t("#campus_select_close").click()}},setMapCenter:function(e){d.setCenter(e)},setMapZoom:function(e){d.setZoom(e)},setCampus:function(e){if(r){t("#"+e).click()}},addEventMarker:function(e,r,i,s){var o=new n.LatLng(e,r),u=new n.Marker({map:d,position:o,flat:true,clickable:true,icon:{url:h.host_url+h.image_path+"Icons/icon_events.png"}});n.event.addListener(u,"click",function(){if(this.infoWindow!=null){this.infoWindow.open(d,this)}else{this.infoWindow=new InfoBubble({content:s,maxWidth:755});this.infoWindow.open(d,this)}});M(o,16);t("#directionsB").val(i);t("#directionsB_position").val(e+","+r);t("#leftNav_directions_btn").click()},addGeneralMarker:function(e,t,r){var i=new n.LatLng(e,t),s=new n.Marker({map:d,position:i,title:r});n.event.addListener(s,"click",function(){if(this.infoWindow!=null){this.infoWindow.open(d,this)}else{this.infoWindow=new InfoBubble({content:"<div class='bubbleContainer_layer clearfix'><h2>"+r+"</h2></div>",maxWidth:755});this.infoWindow.open(d,this)}});M(i,16)},setUpDirections:function(e,n,i,s,o){t("#directionsA").val(e);t("#directionsB").val(n);t("#directionsA_position").val(i);t("#directionsB_position").val(s);w.travelMode=o;w.processDirections();if(!r){t("#leftNav_directions_btn").click()}}},N={printMap:function(){window.open(D(false)+"&print=1","print","location=0,height=800,width=740,status=1,toolbar=1,menubar=1,scrollbars=1,resizable=1");C.itemClick(u+"_general","print")},createPrintablePage:function(){t("#map_canvas").height(700).width(700).css({position:"absolute",top:"50px",margin:"20px","float":"none",border:"1px solid #444444"}).appendTo("body");t("#form1").hide();t('<a href="javascript:void(0)" class="btn" onclick="window.print();">Print</a>').appendTo("body").css({position:"absolute",top:"20px",left:"674px"});t('<img src="static/css/custom/maps/img/print-logo.png" alt="University of Alberta" />').appendTo("body").css({position:"absolute",top:"10px",left:"20px"});t(window).unbind("resize");n.event.trigger(d,"resize")}},C={itemClick:function(e,t){_gaq.push(["default._trackEvent",e.replace(/_/g," ").toLowerCase(),t.replace(/_/g," ").toLowerCase(),"",0,false])}};return{initialise:A,focusBuilding:_,addNewLayer:y.addNewLayer,createMapLink:P,printMap:N.printMap,createPrintablePage:N.createPrintablePage,updateInfoWindow:y.updateInfoWindow,Directions:{process:w.processDirections,clear:w.clearDirections,toggleTravelMode:w.toggleTravelMode,setDestination:w.setDestination,setStartingWaypoint:w.setStartingWaypoint,setEndingWaypoint:w.setEndingWaypoint,setWaypointDestination:w.setWaypointDestination,setMarkerDestination:w.setMarkerDestination,generateLink:w.generateLink},launchInterior:S.launchInterior,switchBuilding:S.switchBuilding,switchLevel:S.switchLevel,loadingBarToggle:E.toggleLoadingBar,errorBarToggle:E.toggleErrorBar,searchResultClick:x.resultClick,urlParameterFunctions:{registerEvent:T.regesterEvent,setCenter:T.setMapCenter,setZoom:T.setMapZoom,addEventMarker:T.addEventMarker,addGeneralMarker:T.addGeneralMarker,setUpDirections:T.setUpDirections,setCampus:T.setCampus},closeOpenWindows:L}}(UAlberta.Maps.Exterior||{},jQuery)